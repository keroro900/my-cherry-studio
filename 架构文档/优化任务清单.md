# Cherry Studio å·¥ä½œæµæ¨¡å—ä¼˜åŒ–ä»»åŠ¡æ¸…å•

**ç‰ˆæœ¬**: 1.0  
**åˆ›å»ºæ—¶é—´**: 2024å¹´12æœˆ11æ—¥  
**è´Ÿè´£äºº**: å¼€å‘å›¢é˜Ÿ  
**é¢„è®¡å®Œæˆ**: 2025å¹´3æœˆ

## ä»»åŠ¡æ¦‚è§ˆ

åŸºäºæ¶æ„åˆ†æï¼Œè¯†åˆ«å‡º12ä¸ªå…³é”®ä¼˜åŒ–ä»»åŠ¡ï¼ŒæŒ‰ä¼˜å…ˆçº§åˆ†ä¸º3ä¸ªå±‚çº§ï¼š
- **P0 (å…³é”®ä¿®å¤)**: 3ä¸ªä»»åŠ¡ï¼Œ2å‘¨å†…å®Œæˆ
- **P1 (åŠŸèƒ½å¢å¼º)**: 4ä¸ªä»»åŠ¡ï¼Œ4å‘¨å†…å®Œæˆ  
- **P2 (ç”Ÿæ€æ‰©å±•)**: 5ä¸ªä»»åŠ¡ï¼Œ12å‘¨å†…å®Œæˆ

---

## P0 - ç«‹å³æ‰§è¡Œä»»åŠ¡ ğŸ”´

### H1: ç»Ÿä¸€èŠ‚ç‚¹æ³¨å†Œç³»ç»Ÿ

**ä¼˜å…ˆçº§**: ğŸ”´ P0 - å…³é”®  
**é¢„ä¼°å·¥æœŸ**: 3-5å¤©  
**è´Ÿè´£äºº**: å¾…åˆ†é…  

#### é—®é¢˜æè¿°
å­˜åœ¨ä¸¤å¥—å¹¶è¡Œçš„èŠ‚ç‚¹æ³¨å†Œæœºåˆ¶ï¼Œé€ æˆä»£ç ç»´æŠ¤å¤æ‚æ€§å’Œæ½œåœ¨çš„ä¸ä¸€è‡´æ€§é—®é¢˜ï¼š

1. **æ—§ç³»ç»Ÿ**: `NODE_REGISTRY` - é™æ€å¸¸é‡å®šä¹‰ï¼ˆ30+èŠ‚ç‚¹ï¼‰
2. **æ–°ç³»ç»Ÿ**: `NodeRegistry` - å•ä¾‹ç±»ï¼Œæ”¯æŒåŠ¨æ€åŠ è½½

#### æ¶‰åŠæ–‡ä»¶
```
src/renderer/src/pages/workflow/nodes/definitions/index.ts  (900+ lines)
src/renderer/src/pages/workflow/nodes/base/NodeRegistry.ts   (290+ lines)  
src/renderer/src/pages/workflow/engine/WorkflowEngine.ts     (å¼•ç”¨å¤„ç†)
```

#### è§£å†³æ–¹æ¡ˆ
1. **Phase 1**: åˆ›å»ºè¿ç§»è„šæœ¬ï¼Œå°† NODE_REGISTRY ä¸­çš„èŠ‚ç‚¹é€ä¸ªæ³¨å†Œåˆ° NodeRegistry
2. **Phase 2**: ä¿®æ”¹ WorkflowEngine ä½¿ç”¨ NodeRegistry æ¥å£
3. **Phase 3**: åºŸå¼ƒ NODE_REGISTRYï¼Œæ¸…ç†ç›¸å…³å¼•ç”¨

#### éªŒæ”¶æ ‡å‡†
- [ ] æ‰€æœ‰èŠ‚ç‚¹é€šè¿‡ NodeRegistry å•ä¸€æ¥å£è®¿é—®
- [ ] åˆ é™¤ NODE_REGISTRY å¸¸é‡å®šä¹‰
- [ ] å·¥ä½œæµæ‰§è¡ŒåŠŸèƒ½æ­£å¸¸ï¼Œæ‰€æœ‰èŠ‚ç‚¹å¯ç”¨
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 85%

#### é£é™©è¯„ä¼°
- **é£é™©**: è¿ç§»è¿‡ç¨‹ä¸­å¯èƒ½å½±å“ç°æœ‰å·¥ä½œæµ
- **ç¼“è§£**: åˆ†é˜¶æ®µè¿ç§»ï¼Œä¿æŒå‘åå…¼å®¹

---

### H2: æ‹†åˆ† WorkflowEngine.ts

**ä¼˜å…ˆçº§**: ğŸ”´ P0 - å…³é”®  
**é¢„ä¼°å·¥æœŸ**: 5-7å¤©  
**è´Ÿè´£äºº**: å¾…åˆ†é…  

#### é—®é¢˜æè¿°
WorkflowEngine.ts å•æ–‡ä»¶çº¦2500è¡Œä»£ç ï¼ŒèŒè´£è¿‡é‡ï¼ŒåŒ…å«ï¼š
- å·¥ä½œæµæ‰§è¡Œé€»è¾‘
- èŠ‚ç‚¹è°ƒåº¦ç®¡ç†
- è¾“å…¥è¾“å‡ºå¤„ç†
- é”™è¯¯å¤„ç†
- å®¢æˆ·ç«¯ç®¡ç†

#### å½“å‰æ¶æ„é—®é¢˜
```typescript
// å½“å‰ - å•ä¸€å·¨å¤§æ–‡ä»¶
WorkflowEngine.ts (2500+ lines)
â”œâ”€â”€ æ‰§è¡Œä¸Šä¸‹æ–‡ç®¡ç†
â”œâ”€â”€ èŠ‚ç‚¹è°ƒåº¦é€»è¾‘  
â”œâ”€â”€ è¾“å…¥æ•°æ®æ”¶é›†
â”œâ”€â”€ è¾“å‡ºç»“æœå¤„ç†
â”œâ”€â”€ å®¢æˆ·ç«¯åˆå§‹åŒ–
â”œâ”€â”€ é”™è¯¯å¤„ç†
â””â”€â”€ æ‰¹æ¬¡å¤„ç†
```

#### é‡æ„ç›®æ ‡æ¶æ„
```typescript
// ç›®æ ‡ - èŒè´£åˆ†ç¦»
WorkflowEngine.ts (500 lines)          // æ ¸å¿ƒç¼–æ’é€»è¾‘
ExecutionContext.ts (300 lines)        // æ‰§è¡Œä¸Šä¸‹æ–‡ç®¡ç†
NodeScheduler.ts (400 lines)           // èŠ‚ç‚¹è°ƒåº¦å™¨
InputCollector.ts (200 lines)          // è¾“å…¥æ”¶é›†å™¨
OutputHandler.ts (300 lines)           // è¾“å‡ºå¤„ç†å™¨
ErrorHandler.ts (150 lines)            // é”™è¯¯å¤„ç†å™¨  
BatchExecutor.ts (250 lines)           // æ‰¹å¤„ç†å™¨
```

#### æ‹†åˆ†è®¡åˆ’

**ç¬¬ä¸€é˜¶æ®µ: æå–ç‹¬ç«‹æ¨¡å—**
1. æå– `ExecutionContext` ç±» - ç®¡ç†æ‰§è¡ŒçŠ¶æ€
2. æå– `InputCollector` ç±» - æ”¶é›†èŠ‚ç‚¹è¾“å…¥
3. æå– `OutputHandler` ç±» - å¤„ç†èŠ‚ç‚¹è¾“å‡º

**ç¬¬äºŒé˜¶æ®µ: æ ¸å¿ƒé€»è¾‘é‡æ„**  
4. æå– `NodeScheduler` ç±» - èŠ‚ç‚¹è°ƒåº¦å’Œä¾èµ–è§£æ
5. æå– `ErrorHandler` ç±» - ç»Ÿä¸€é”™è¯¯å¤„ç†
6. é‡æ„ `WorkflowEngine` - ä¿ç•™æ ¸å¿ƒç¼–æ’é€»è¾‘

**ç¬¬ä¸‰é˜¶æ®µ: é«˜çº§åŠŸèƒ½**
7. æå– `BatchExecutor` ç±» - æ‰¹å¤„ç†æ”¯æŒ

#### éªŒæ”¶æ ‡å‡†
- [ ] æ¯ä¸ªæ–‡ä»¶ < 500 è¡Œä»£ç 
- [ ] èŒè´£å•ä¸€ï¼Œæ¥å£æ¸…æ™°
- [ ] ç°æœ‰åŠŸèƒ½å®Œå…¨å…¼å®¹
- [ ] æ€§èƒ½æ— æ˜æ˜¾é€€åŒ–
- [ ] ä»£ç è¦†ç›–ç‡ > 90%

---

### H3: ç±»å‹å®šä¹‰å»é‡

**ä¼˜å…ˆçº§**: ğŸ”´ P0 - å…³é”®  
**é¢„ä¼°å·¥æœŸ**: 1-2å¤©  
**è´Ÿè´£äºº**: å¾…åˆ†é…  

#### é—®é¢˜æè¿°
å…³é”®ç±»å‹ `NodeExecutionResult` åœ¨3ä¸ªä½ç½®é‡å¤å®šä¹‰ï¼Œå¯èƒ½å¯¼è‡´ç±»å‹ä¸ä¸€è‡´ï¼š

```typescript
// ä½ç½®1: engine/WorkflowEngine.ts:45
export interface NodeExecutionResult {
  nodeId: string
  status: 'success' | 'error' | 'skipped'
  outputs: Record<string, any>
  errorMessage?: string
  duration?: number
}

// ä½ç½®2: types/index.ts:119 
export interface NodeExecutionResult { /* ç›¸åŒå®šä¹‰ */ }

// ä½ç½®3: nodes/base/types.ts:121
export interface NodeExecutionResult { /* ç›¸åŒå®šä¹‰ */ }
```

#### è§£å†³æ–¹æ¡ˆ
1. **åˆ›å»ºç»Ÿä¸€ç±»å‹æ–‡ä»¶**: `src/renderer/src/pages/workflow/types/core.ts`
2. **åˆå¹¶é‡å¤ç±»å‹å®šä¹‰**:
   - `NodeExecutionResult` 
   - `WorkflowExecutionContext`
   - `NodeExecutionContext`
3. **æ›´æ–°æ‰€æœ‰å¼•ç”¨**

#### æ–‡ä»¶ç»“æ„
```typescript
// types/core.ts - æ ¸å¿ƒç±»å‹å®šä¹‰
export interface NodeExecutionResult { ... }
export interface WorkflowExecutionContext { ... }
export interface NodeExecutionContext { ... }

// å…¶ä»–æ–‡ä»¶é€šè¿‡ import å¼•ç”¨
import type { NodeExecutionResult } from '../types/core'
```

#### éªŒæ”¶æ ‡å‡†
- [ ] æ‰€æœ‰é‡å¤ç±»å‹å®šä¹‰å·²åˆå¹¶
- [ ] åˆ›å»º `types/core.ts` ä½œä¸ºå•ä¸€æ¥æº
- [ ] æ‰€æœ‰å¼•ç”¨å·²æ›´æ–°ï¼Œç¼–è¯‘æ­£å¸¸
- [ ] TypeScript ç±»å‹æ£€æŸ¥é€šè¿‡

---

## P1 - çŸ­æœŸè§„åˆ’ä»»åŠ¡ ğŸŸ¡

### M1: å¤ç”¨åŸç”Ÿ ImageGenerationService

**ä¼˜å…ˆçº§**: ğŸŸ¡ P1 - é«˜  
**é¢„ä¼°å·¥æœŸ**: 3-4å¤©  
**è´Ÿè´£äºº**: å¾…åˆ†é…  

#### é—®é¢˜æè¿°
`WorkflowAiService` ä¸­é‡å¤å®ç°äº†å›¾åƒç”Ÿæˆé€»è¾‘ï¼Œå­˜åœ¨ä»£ç é‡å¤å’Œç»´æŠ¤æˆæœ¬é—®é¢˜ã€‚

#### å½“å‰å®ç°å¯¹æ¯”

**åŸç”ŸæœåŠ¡ (ImageGenerationService.ts)**
```typescript
export class ImageGenerationService {
  async generateImage(params: ImageGenerationParams): Promise<ImageGenerationResult>
  // ç»Ÿä¸€çš„å›¾åƒç”Ÿæˆæ¥å£ï¼Œæ”¯æŒå¤šç§æ¨¡å‹
}
```

**å·¥ä½œæµå®ç° (WorkflowAiService.ts)**
```typescript
export class WorkflowAiService {
  static async generateGeminiImage(params: GeminiImageGenerationParams): Promise<string[]>
  // é‡å¤å®ç°ï¼ŒåŠŸèƒ½ç›¸ä¼¼ä½†æ¥å£ä¸ç»Ÿä¸€
}
```

#### é‡æ„æ–¹æ¡ˆ
1. **ç»Ÿä¸€æ¥å£**: WorkflowAiService è°ƒç”¨ ImageGenerationService
2. **å‚æ•°é€‚é…**: åˆ›å»ºå‚æ•°è½¬æ¢é€‚é…å™¨
3. **é”™è¯¯å¤„ç†**: ç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶

#### ä»£ç ç¤ºä¾‹
```typescript
// é‡æ„åçš„ WorkflowAiService
export class WorkflowAiService {
  static async generateImage(params: WorkflowImageParams): Promise<string[]> {
    const adaptedParams = this.adaptImageParams(params)
    const service = new ImageGenerationService(provider, model)
    const result = await service.generateImage(adaptedParams)
    return result.images
  }
}
```

#### éªŒæ”¶æ ‡å‡†
- [ ] WorkflowAiService ä½¿ç”¨ ImageGenerationService æ¥å£
- [ ] åŠŸèƒ½å®Œå…¨å…¼å®¹ï¼Œæ— å›å½’é—®é¢˜
- [ ] åˆ é™¤é‡å¤çš„å›¾åƒç”Ÿæˆä»£ç 
- [ ] æ·»åŠ é€‚é…å±‚å•å…ƒæµ‹è¯•

---

### M2: å¤ç”¨åŸç”Ÿ Provider/Model è·å–é€»è¾‘

**ä¼˜å…ˆçº§**: ğŸŸ¡ P1 - ä¸­  
**é¢„ä¼°å·¥æœŸ**: 2-3å¤©  
**è´Ÿè´£äºº**: å¾…åˆ†é…  

#### é—®é¢˜æè¿°
`getProviderAndModel()` æ–¹æ³•åœ¨å¤šä¸ªåœ°æ–¹é‡å¤å®ç°ï¼š

```typescript
// WorkflowAiService.ts
static getProviderAndModel(providerId: string, modelId: string): { provider, model }

// å…¶ä»–æœåŠ¡ä¸­ç±»ä¼¼å®ç°
// AssistantService.ts æœ‰ç±»ä¼¼é€»è¾‘
```

#### é‡æ„æ–¹æ¡ˆ
ä½¿ç”¨ AssistantService ç°æœ‰çš„ç»Ÿä¸€æ¥å£ï¼š

```typescript
// ä½¿ç”¨ç»Ÿä¸€æ¥å£
import { AssistantService } from '@renderer/services/AssistantService'

export class WorkflowAiService {
  static getProviderAndModel(providerId: string, modelId: string) {
    return AssistantService.getProviderByModel(modelId)
  }
}
```

#### éªŒæ”¶æ ‡å‡†
- [ ] åˆ é™¤é‡å¤çš„ getProviderAndModel å®ç°
- [ ] ä½¿ç”¨ AssistantService ç»Ÿä¸€æ¥å£
- [ ] æ‰€æœ‰è°ƒç”¨å¤„æ›´æ–°å®Œæ¯•
- [ ] åŠŸèƒ½éªŒè¯é€šè¿‡

---

### M3: å®ç°æ‰¹å¤„ç†æ‰§è¡Œ

**ä¼˜å…ˆçº§**: ğŸŸ¡ P1 - ä¸­  
**é¢„ä¼°å·¥æœŸ**: 4-5å¤©  
**è´Ÿè´£äºº**: å¾…åˆ†é…  

#### é—®é¢˜æè¿°
å½“å‰å·¥ä½œæµåªæ”¯æŒå•æ¬¡æ‰§è¡Œï¼Œç¼ºä¹æ‰¹é‡å¤„ç†èƒ½åŠ›ï¼Œé™åˆ¶äº†å®ç”¨æ€§ã€‚

#### éœ€æ±‚åˆ†æ
1. **æ‰¹é‡å›¾ç‰‡å¤„ç†**: ä¸€æ¬¡æ€§å¤„ç†å¤šä¸ªæ–‡ä»¶å¤¹çš„å›¾ç‰‡
2. **æ‰¹é‡æ–‡æœ¬å¤„ç†**: å¤„ç†æ–‡æœ¬åˆ—è¡¨
3. **ç»“æœåˆ†ç»„**: æŒ‰æ‰¹æ¬¡åˆ†ç»„ä¿å­˜ç»“æœ
4. **è¿›åº¦è·Ÿè¸ª**: å®æ—¶æ˜¾ç¤ºæ‰¹å¤„ç†è¿›åº¦

#### æŠ€æœ¯è®¾è®¡

**æ–°å¢æ–‡ä»¶**: `src/renderer/src/pages/workflow/engine/BatchExecutor.ts`

```typescript
export class BatchExecutor {
  async executeBatch(workflow: Workflow, batches: BatchItem[]): Promise<BatchResult[]>
  
  private async executeSingleBatch(workflow: Workflow, batch: BatchItem): Promise<BatchResult>
  
  private createBatchContext(batchIndex: number, totalBatches: number): WorkflowExecutionContext
}

export interface BatchItem {
  id: string
  inputs: Record<string, any>
  name?: string
}

export interface BatchResult {
  batchId: string
  status: 'success' | 'error'
  outputs: Record<string, any>
  duration: number
  errorMessage?: string
}
```

#### UI è®¾è®¡
1. **æ‰¹é‡æ¨¡å¼å¼€å…³**: å·¥ä½œæµé¡µé¢æ·»åŠ æ‰¹é‡æ¨¡å¼åˆ‡æ¢
2. **æ‰¹æ¬¡é…ç½®**: é…ç½®æ‰¹å¤„ç†å‚æ•°
3. **è¿›åº¦æ˜¾ç¤º**: æ˜¾ç¤ºå½“å‰æ‰¹æ¬¡å’Œæ€»è¿›åº¦
4. **ç»“æœç®¡ç†**: æ‰¹é‡ç»“æœæŸ¥çœ‹å’Œå¯¼å‡º

#### éªŒæ”¶æ ‡å‡†
- [ ] å®ç° BatchExecutor ç±»
- [ ] æ”¯æŒå›¾ç‰‡å’Œæ–‡æœ¬æ‰¹é‡å¤„ç†
- [ ] UI æ”¯æŒæ‰¹é‡æ¨¡å¼åˆ‡æ¢
- [ ] è¿›åº¦æ˜¾ç¤ºå’Œå–æ¶ˆåŠŸèƒ½
- [ ] ç»“æœæŒ‰æ‰¹æ¬¡åˆ†ç»„ä¿å­˜

---

### M4: å®ç°æ‰§è¡Œå‰æ£€æŸ¥ (Pre-flight Check)

**ä¼˜å…ˆçº§**: ğŸŸ¡ P1 - ä¸­  
**é¢„ä¼°å·¥æœŸ**: 2-3å¤©  
**è´Ÿè´£äºº**: å¾…åˆ†é…  

#### é—®é¢˜æè¿°
å·¥ä½œæµè¿è¡Œå‰ç¼ºä¹å®Œæ•´æ€§éªŒè¯ï¼Œå®¹æ˜“åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚

#### æ£€æŸ¥é¡¹ç›®
1. **æ‹“æ‰‘æ£€æŸ¥**:
   - æ£€æµ‹å­¤ç«‹èŠ‚ç‚¹
   - æ£€æµ‹å¾ªç¯ä¾èµ–
   - éªŒè¯è¿çº¿å®Œæ•´æ€§

2. **é…ç½®æ£€æŸ¥**:
   - å¿…å¡«å‚æ•°æ£€æŸ¥
   - æ¨¡å‹å¯ç”¨æ€§æ£€æŸ¥  
   - æ–‡ä»¶è·¯å¾„æœ‰æ•ˆæ€§æ£€æŸ¥

3. **å…¼å®¹æ€§æ£€æŸ¥**:
   - æ•°æ®ç±»å‹å…¼å®¹æ€§
   - ç«¯å£è¿æ¥åˆæ³•æ€§
   - èŠ‚ç‚¹ç‰ˆæœ¬å…¼å®¹æ€§

#### æŠ€æœ¯å®ç°

**æ–°å¢æ–‡ä»¶**: `src/renderer/src/pages/workflow/engine/PreflightChecker.ts`

```typescript
export class PreflightChecker {
  static async checkWorkflow(workflow: Workflow): Promise<PreflightResult>
  
  private static checkTopology(workflow: Workflow): TopologyIssue[]
  private static checkConfiguration(workflow: Workflow): ConfigIssue[]  
  private static checkCompatibility(workflow: Workflow): CompatibilityIssue[]
}

export interface PreflightResult {
  success: boolean
  errors: PreflightIssue[]
  warnings: PreflightIssue[]
}

export interface PreflightIssue {
  type: 'error' | 'warning'
  nodeId: string
  code: string
  message: string
  suggestion?: string
}
```

#### UI é›†æˆ
1. **è¿è¡Œå‰æ£€æŸ¥**: ç‚¹å‡»è¿è¡Œæ—¶è‡ªåŠ¨æ‰§è¡Œæ£€æŸ¥
2. **é—®é¢˜åˆ—è¡¨**: æ˜¾ç¤ºæ£€æŸ¥å‡ºçš„é—®é¢˜å’Œå»ºè®®
3. **ä¸€é”®ä¿®å¤**: å¯¹äºå¯è‡ªåŠ¨ä¿®å¤çš„é—®é¢˜æä¾›å¿«é€Ÿä¿®å¤
4. **å¼ºåˆ¶è¿è¡Œ**: å…è®¸å¿½ç•¥è­¦å‘Šå¼ºåˆ¶è¿è¡Œ

#### éªŒæ”¶æ ‡å‡†
- [ ] å®ç° PreflightChecker ç±»
- [ ] è¦†ç›–ä¸»è¦æ£€æŸ¥é¡¹ç›®
- [ ] UI æ˜¾ç¤ºæ£€æŸ¥ç»“æœ  
- [ ] æ”¯æŒé—®é¢˜ä¿®å¤å»ºè®®
- [ ] å¯é…ç½®æ£€æŸ¥è§„åˆ™

---

## P2 - ä¸­é•¿æœŸè§„åˆ’ä»»åŠ¡ ğŸŸ¢

### L1: é›†æˆçŸ¥è¯†åº“æœç´¢èŠ‚ç‚¹

**ä¼˜å…ˆçº§**: ğŸŸ¢ P2 - é«˜  
**é¢„ä¼°å·¥æœŸ**: 1-2å‘¨  
**è´Ÿè´£äºº**: å¾…åˆ†é…  

#### åŠŸèƒ½æè¿°
åˆ›å»ºçŸ¥è¯†åº“æœç´¢èŠ‚ç‚¹ï¼Œå¤ç”¨ Cherry Studio çš„ RAG æ£€ç´¢èƒ½åŠ›ã€‚

#### èŠ‚ç‚¹è®¾è®¡
```typescript
export const KNOWLEDGE_SEARCH_NODE: NodeDefinition = {
  type: WorkflowNodeType.KNOWLEDGE_SEARCH,
  label: 'çŸ¥è¯†åº“æœç´¢',
  icon: 'ğŸ”',
  category: 'ai',
  inputs: [
    { id: 'query', label: 'æœç´¢æŸ¥è¯¢', dataType: 'text', required: true },
    { id: 'knowledge_base', label: 'çŸ¥è¯†åº“', dataType: 'text' }
  ],
  outputs: [
    { id: 'results', label: 'æœç´¢ç»“æœ', dataType: 'json' },
    { id: 'text', label: 'ç»“æœæ–‡æœ¬', dataType: 'text' }
  ]
}
```

#### å¤ç”¨æœåŠ¡
```typescript
// å¤ç”¨ä¸»è¿›ç¨‹ KnowledgeService  
import { KnowledgeService } from '@main/services/KnowledgeService'

export class KnowledgeSearchExecutor implements NodeExecutor {
  async execute(inputs: Record<string, any>): Promise<NodeExecutionResult> {
    const results = await window.api.knowledge.search(inputs.query, {
      knowledgeBase: inputs.knowledge_base,
      limit: 10
    })
    
    return this.success({
      results: results,
      text: results.map(r => r.content).join('\n')
    })
  }
}
```

#### éªŒæ”¶æ ‡å‡†
- [ ] å®ç°çŸ¥è¯†åº“æœç´¢èŠ‚ç‚¹
- [ ] é›†æˆ KnowledgeService API
- [ ] æ”¯æŒå¤šçŸ¥è¯†åº“é€‰æ‹©
- [ ] ç»“æœæ ¼å¼åŒ–è¾“å‡º
- [ ] æ·»åŠ æœç´¢å‚æ•°é…ç½®

---

### L2: é›†æˆè®°å¿†ç®¡ç†èŠ‚ç‚¹

**ä¼˜å…ˆçº§**: ğŸŸ¢ P2 - é«˜  
**é¢„ä¼°å·¥æœŸ**: 1-2å‘¨  
**è´Ÿè´£äºº**: å¾…åˆ†é…  

#### åŠŸèƒ½æè¿°
åˆ›å»ºè®°å¿†æœç´¢å’Œä¿å­˜èŠ‚ç‚¹ï¼Œåˆ©ç”¨ MemoryService çš„é•¿æœŸè®°å¿†åŠŸèƒ½ã€‚

#### èŠ‚ç‚¹è®¾è®¡
```typescript
// è®°å¿†æœç´¢èŠ‚ç‚¹
MEMORY_SEARCH = 'memory_search'

// è®°å¿†ä¿å­˜èŠ‚ç‚¹  
MEMORY_SAVE = 'memory_save'
```

#### åº”ç”¨åœºæ™¯
1. **ä¸Šä¸‹æ–‡è®°å¿†**: ä¿å­˜å¯¹è¯ä¸Šä¸‹æ–‡ï¼Œè·¨ä¼šè¯ä½¿ç”¨
2. **çŸ¥è¯†ç§¯ç´¯**: ç§¯ç´¯å¤„ç†ç»éªŒï¼Œä¼˜åŒ–åç»­å¤„ç†
3. **ä¸ªæ€§åŒ–**: åŸºäºå†å²è®°å½•ä¸ªæ€§åŒ–å¤„ç†

#### éªŒæ”¶æ ‡å‡†
- [ ] å®ç°è®°å¿†æœç´¢å’Œä¿å­˜èŠ‚ç‚¹
- [ ] é›†æˆ MemoryService API
- [ ] æ”¯æŒè®°å¿†åˆ†ç±»å’Œæ ‡ç­¾
- [ ] æä¾›è®°å¿†ç®¡ç†ç•Œé¢

---

### L3: é›†æˆ MCP å·¥å…·è°ƒç”¨èŠ‚ç‚¹

**ä¼˜å…ˆçº§**: ğŸŸ¢ P2 - ä¸­  
**é¢„ä¼°å·¥æœŸ**: 2-3å‘¨  
**è´Ÿè´£äºº**: å¾…åˆ†é…  

#### åŠŸèƒ½æè¿°
åˆ›å»º MCP å·¥å…·èŠ‚ç‚¹ï¼Œæ”¯æŒåŠ¨æ€å·¥å…·å‘ç°å’Œè°ƒç”¨ã€‚

#### èŠ‚ç‚¹è®¾è®¡
```typescript
export const MCP_TOOL_NODE: NodeDefinition = {
  type: WorkflowNodeType.MCP_TOOL,
  label: 'MCP å·¥å…·è°ƒç”¨',
  icon: 'ğŸ› ï¸',
  category: 'external',
  inputs: [
    { id: 'tool_name', label: 'å·¥å…·åç§°', dataType: 'text', required: true },
    { id: 'parameters', label: 'è°ƒç”¨å‚æ•°', dataType: 'json' }
  ],
  outputs: [
    { id: 'result', label: 'è°ƒç”¨ç»“æœ', dataType: 'json' },
    { id: 'success', label: 'æˆåŠŸçŠ¶æ€', dataType: 'boolean' }
  ]
}
```

#### æŠ€æœ¯å®ç°
1. **å·¥å…·å‘ç°**: ä» MCPService è·å–å¯ç”¨å·¥å…·åˆ—è¡¨
2. **åŠ¨æ€è°ƒç”¨**: æ”¯æŒä»»æ„ MCP å·¥å…·è°ƒç”¨
3. **å‚æ•°éªŒè¯**: æ ¹æ®å·¥å…· schema éªŒè¯å‚æ•°
4. **ç»“æœå¤„ç†**: ç»Ÿä¸€å¤„ç†è°ƒç”¨ç»“æœ

#### éªŒæ”¶æ ‡å‡†
- [ ] å®ç° MCP å·¥å…·è°ƒç”¨èŠ‚ç‚¹
- [ ] æ”¯æŒå·¥å…·åŠ¨æ€å‘ç°
- [ ] å‚æ•° schema éªŒè¯
- [ ] é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

---

### L4: å®ç°å·¥ä½œæµç‰ˆæœ¬æ§åˆ¶

**ä¼˜å…ˆçº§**: ğŸŸ¢ P2 - ä¸­  
**é¢„ä¼°å·¥æœŸ**: 2-3å‘¨  
**è´Ÿè´£äºº**: å¾…åˆ†é…  

#### åŠŸèƒ½æè¿°
ä¸ºå·¥ä½œæµæ·»åŠ ç‰ˆæœ¬æ§åˆ¶åŠŸèƒ½ï¼Œæ”¯æŒç‰ˆæœ¬ç®¡ç†å’Œå›æ»šã€‚

#### åŠŸèƒ½ç‰¹æ€§
1. **è‡ªåŠ¨ç‰ˆæœ¬**: ä¿å­˜æ—¶è‡ªåŠ¨åˆ›å»ºç‰ˆæœ¬å¿«ç…§
2. **ç‰ˆæœ¬æ¯”è¾ƒ**: å¯è§†åŒ–æ¯”è¾ƒç‰ˆæœ¬å·®å¼‚
3. **ç‰ˆæœ¬å›æ»š**: ä¸€é”®å›æ»šåˆ°å†å²ç‰ˆæœ¬
4. **åˆ†æ”¯ç®¡ç†**: æ”¯æŒåˆ›å»ºåˆ†æ”¯è¿›è¡Œå®éªŒ

#### å­˜å‚¨è®¾è®¡
```typescript
export interface WorkflowVersion {
  id: string
  workflowId: string
  version: string // "v1.0.0"
  timestamp: number
  author: string
  message: string
  snapshot: Workflow
  parentVersion?: string
}

export interface WorkflowBranch {
  name: string
  workflowId: string
  headVersion: string
  created: number
}
```

#### éªŒæ”¶æ ‡å‡†
- [ ] å®ç°ç‰ˆæœ¬å¿«ç…§åŠŸèƒ½
- [ ] ç‰ˆæœ¬æ¯”è¾ƒå’Œå¯è§†åŒ–
- [ ] æ”¯æŒç‰ˆæœ¬å›æ»š
- [ ] åˆ†æ”¯ç®¡ç†åŠŸèƒ½

---

### L5: å®ç°å•èŠ‚ç‚¹é¢„è§ˆ

**ä¼˜å…ˆçº§**: ğŸŸ¢ P2 - ä½  
**é¢„ä¼°å·¥æœŸ**: 1-2å‘¨  
**è´Ÿè´£äºº**: å¾…åˆ†é…  

#### åŠŸèƒ½æè¿°
æ”¯æŒå•ä¸ªèŠ‚ç‚¹çš„é¢„è§ˆæ‰§è¡Œï¼Œç”¨äºè°ƒè¯•å’Œæµ‹è¯•ã€‚

#### åŠŸèƒ½ç‰¹æ€§
1. **å³é”®é¢„è§ˆ**: èŠ‚ç‚¹å³é”®èœå•æ·»åŠ "é¢„è§ˆæ‰§è¡Œ"
2. **æ¨¡æ‹Ÿè¾“å…¥**: ä¸ºä¸Šæ¸¸è¾“å…¥æä¾›æ¨¡æ‹Ÿæ•°æ®
3. **å®æ—¶ç»“æœ**: æ˜¾ç¤ºèŠ‚ç‚¹æ‰§è¡Œç»“æœ
4. **è°ƒè¯•ä¿¡æ¯**: æ˜¾ç¤ºè¯¦ç»†çš„æ‰§è¡Œæ—¥å¿—

#### æŠ€æœ¯å®ç°
```typescript
export class NodePreviewExecutor {
  async previewNode(
    nodeId: string, 
    workflow: Workflow, 
    mockInputs?: Record<string, any>
  ): Promise<NodePreviewResult>
  
  private generateMockInputs(node: WorkflowNode): Record<string, any>
}

export interface NodePreviewResult extends NodeExecutionResult {
  mockInputsUsed: Record<string, any>
  executionLog: string[]
}
```

#### UI è®¾è®¡
1. **é¢„è§ˆé¢æ¿**: ä¾§è¾¹é¢æ¿æ˜¾ç¤ºé¢„è§ˆç»“æœ
2. **è¾“å…¥ç¼–è¾‘**: å¯ç¼–è¾‘æ¨¡æ‹Ÿè¾“å…¥æ•°æ®
3. **ç»“æœå±•ç¤º**: å¤šç§æ ¼å¼æ˜¾ç¤ºç»“æœ
4. **æ—¥å¿—æŸ¥çœ‹**: è¯¦ç»†çš„æ‰§è¡Œæ—¥å¿—

#### éªŒæ”¶æ ‡å‡†
- [ ] å®ç°å•èŠ‚ç‚¹é¢„è§ˆåŠŸèƒ½
- [ ] æ¨¡æ‹Ÿè¾“å…¥æ•°æ®ç”Ÿæˆ
- [ ] é¢„è§ˆç»“æœå¯è§†åŒ–
- [ ] è°ƒè¯•ä¿¡æ¯å±•ç¤º

---

## å®æ–½è®¡åˆ’

### æ—¶é—´çº¿è§„åˆ’

```
2024å¹´12æœˆ - 2025å¹´3æœˆ æ€»ä½“è§„åˆ’

12æœˆç¬¬3å‘¨ (12/16-12/22)
â”œâ”€â”€ H1: ç»Ÿä¸€èŠ‚ç‚¹æ³¨å†Œç³»ç»Ÿ (3-5å¤©)
â””â”€â”€ H3: ç±»å‹å®šä¹‰å»é‡ (1-2å¤©)

12æœˆç¬¬4å‘¨ - 1æœˆç¬¬1å‘¨ (12/23-01/05)  
â””â”€â”€ H2: æ‹†åˆ† WorkflowEngine.ts (5-7å¤©)

1æœˆç¬¬2å‘¨ - 1æœˆç¬¬3å‘¨ (01/06-01/19)
â”œâ”€â”€ M1: å¤ç”¨åŸç”Ÿ ImageGenerationService (3-4å¤©)  
â””â”€â”€ M2: å¤ç”¨åŸç”Ÿ Provider/Model è·å–é€»è¾‘ (2-3å¤©)

1æœˆç¬¬4å‘¨ - 2æœˆç¬¬1å‘¨ (01/20-02/02)
â”œâ”€â”€ M3: å®ç°æ‰¹å¤„ç†æ‰§è¡Œ (4-5å¤©)
â””â”€â”€ M4: å®ç°æ‰§è¡Œå‰æ£€æŸ¥ (2-3å¤©)  

2æœˆç¬¬2å‘¨ - 2æœˆç¬¬4å‘¨ (02/03-02/23)
â”œâ”€â”€ L1: é›†æˆçŸ¥è¯†åº“æœç´¢èŠ‚ç‚¹ (1-2å‘¨)
â””â”€â”€ L2: é›†æˆè®°å¿†ç®¡ç†èŠ‚ç‚¹ (1-2å‘¨)

3æœˆç¬¬1å‘¨ - 3æœˆç¬¬3å‘¨ (02/24-03/16) 
â”œâ”€â”€ L3: é›†æˆ MCP å·¥å…·è°ƒç”¨èŠ‚ç‚¹ (2-3å‘¨)
â””â”€â”€ L4: å®ç°å·¥ä½œæµç‰ˆæœ¬æ§åˆ¶ (2-3å‘¨)

3æœˆç¬¬4å‘¨ (03/17-03/23)
â””â”€â”€ L5: å®ç°å•èŠ‚ç‚¹é¢„è§ˆ (1-2å‘¨)
```

### èµ„æºåˆ†é…

**å¼€å‘å›¢é˜Ÿ**: 2-3 åå¼€å‘è€…  
**æµ‹è¯•å›¢é˜Ÿ**: 1 åæµ‹è¯•å·¥ç¨‹å¸ˆ  
**æ€»å·¥æ—¶ä¼°ç®—**: 60-80 å·¥ä½œæ—¥

### é‡Œç¨‹ç¢‘æ£€æŸ¥ç‚¹

| æ—¶é—´èŠ‚ç‚¹ | é‡Œç¨‹ç¢‘ | äº¤ä»˜ç‰© |
|---------|--------|--------|
| 2024/12/29 | P0 ä»»åŠ¡å®Œæˆ | æ¶æ„é—®é¢˜ä¿®å¤ |
| 2025/01/26 | P1 ä»»åŠ¡å®Œæˆ | åŠŸèƒ½å¢å¼ºäº¤ä»˜ |
| 2025/03/23 | P2 ä»»åŠ¡å®Œæˆ | ç”Ÿæ€é›†æˆå®Œæˆ |

### é£é™©ç®¡ç†

**é«˜é£é™©é¡¹ç›®**:
- H2: WorkflowEngine æ‹†åˆ†å¯èƒ½å½±å“ç°æœ‰åŠŸèƒ½
- M3: æ‰¹å¤„ç†æ‰§è¡Œçš„æ€§èƒ½å’Œç¨³å®šæ€§

**ç¼“è§£æªæ–½**:
- åˆ†é˜¶æ®µå®æ–½ï¼Œä¿æŒå‘åå…¼å®¹
- å……åˆ†çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- ç°åº¦å‘å¸ƒå’Œç”¨æˆ·åé¦ˆæ”¶é›†

---

## éªŒæ”¶å’Œæµ‹è¯•

### æµ‹è¯•ç­–ç•¥

**å•å…ƒæµ‹è¯•**: æ¯ä¸ªæ¨¡å— > 85% ä»£ç è¦†ç›–ç‡  
**é›†æˆæµ‹è¯•**: å…³é”®å·¥ä½œæµç«¯åˆ°ç«¯æµ‹è¯•  
**æ€§èƒ½æµ‹è¯•**: æ‰¹å¤„ç†å’Œå¤§å·¥ä½œæµæ€§èƒ½éªŒè¯  
**ç”¨æˆ·éªŒæ”¶æµ‹è¯•**: çœŸå®åœºæ™¯ç”¨æˆ·ä½“éªŒéªŒè¯

### è´¨é‡é—¨ç¦

1. **ä»£ç è´¨é‡**: ESLint + TypeScript ä¸¥æ ¼æ¨¡å¼
2. **æµ‹è¯•è¦†ç›–**: å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 85%
3. **æ€§èƒ½æ ‡å‡†**: å…³é”®æ“ä½œå“åº”æ—¶é—´ < 2s
4. **ç”¨æˆ·ä½“éªŒ**: å¯ç”¨æ€§æµ‹è¯•é€šè¿‡ç‡ > 90%

---

**æ–‡æ¡£ç»´æŠ¤**: æœ¬ä»»åŠ¡æ¸…å•å°†éšå¼€å‘è¿›åº¦å®æ—¶æ›´æ–°ã€‚  
**æ²Ÿé€šæœºåˆ¶**: æ¯å‘¨è¿›åº¦åŒæ­¥ï¼Œå…³é”®èŠ‚ç‚¹é‡Œç¨‹ç¢‘è¯„å®¡ã€‚
