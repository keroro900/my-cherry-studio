/**
 * ReactFlow ç”»å¸ƒå’Œè¿çº¿æ ·å¼ä¼˜åŒ–
 * å‚è€ƒå®˜æ–¹ç¤ºä¾‹ï¼šhttps://reactflow.dev/examples/nodes/custom-node
 */

/* ========== å·¥ä½œæµä¸»é¢˜ CSS å˜é‡ ========== */
/* ä½œç”¨åŸŸé™å®šåœ¨ .workflow-root å†…ï¼Œé¿å…æ±¡æŸ“å…¨å±€æ ·å¼ */
/* æ³¨æ„ï¼šè¿™äº›å˜é‡ä¼šè¢« WorkflowThemeProvider åŠ¨æ€è¦†ç›– */
.workflow-root {
  /* é»˜è®¤ä¸»é¢˜é¢œè‰² (Professional) */
  --workflow-theme-primary: #1890ff;
  --workflow-theme-secondary: #722ed1;
  --workflow-theme-success: #52c41a;
  --workflow-theme-warning: #faad14;
  --workflow-theme-error: #ff4d4f;
  --workflow-theme-info: #13c2c2;

  /* èŠ‚ç‚¹æ ·å¼ */
  --workflow-node-border-radius: 8px;
  --workflow-node-border-width: 2px;
  --workflow-node-padding: 12px 16px;
  --workflow-node-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);

  /* Handle æ ·å¼ */
  --workflow-handle-size: 12px;
  --workflow-handle-border-width: 2px;
}

/* ========== ReactFlow å…¨å±€æ ·å¼ ========== */
/* é™å®šåœ¨ .workflow-root ä½œç”¨åŸŸå†… */
.workflow-root .react-flow {
  /* ä¸»é¢˜è‰² - ä½¿ç”¨å·¥ä½œæµä¸»é¢˜å˜é‡ */
  --xy-theme-edge-hover: var(--workflow-theme-primary, #1890ff);
  --xy-theme-selected: var(--workflow-theme-primary, #1890ff);

  /* è¾¹çš„é¢œè‰² - ä½¿ç”¨å·¥ä½œæµä¸»é¢˜å˜é‡ */
  --xy-edge-stroke-default: var(--workflow-theme-primary, #1890ff);
  --xy-edge-stroke-width-default: 4px;
  --xy-edge-stroke-selected: var(--workflow-theme-success, #52c41a);
  --xy-edge-stroke-hover: var(--workflow-theme-error, #ff4d4f);

  /* èŠ‚ç‚¹æ ·å¼ */
  --xy-node-border-default: 2px solid var(--ant-color-border);
  --xy-node-border-radius-default: var(--workflow-node-border-radius, 8px);
  --xy-node-boxshadow-default: var(--workflow-node-shadow, 0 2px 8px rgba(0, 0, 0, 0.08));

  /* Handle æ ·å¼ */
  --xy-handle-background-color-default: var(--ant-color-bg-container);
  --xy-handle-border-color-default: var(--ant-color-text-secondary);
}

/* å…¨å±€å¼ºåˆ¶æ‰€æœ‰ SVG path å¯è§ - é™å®šä½œç”¨åŸŸ */
.workflow-root .react-flow svg path {
  stroke-opacity: 1;
  opacity: 1;
  visibility: visible;
}

/* ========== Handle æ ·å¼ä¼˜åŒ– v4.0 ========== */
/* é™å®šåœ¨ .workflow-root ä½œç”¨åŸŸå†… */
/* æ–°è®¾è®¡ï¼šå†…åµŒå¼è±å½¢ç«¯å£ï¼Œæ›´å°æ›´ç²¾è‡´ */

/* åŸºç¡€ Handle æ ·å¼ - ç”± DynamicHandles ç»„ä»¶æ§åˆ¶ */
.workflow-root .react-flow__handle {
  /* è®©ç»„ä»¶æ ·å¼å®Œå…¨æ§åˆ¶ */
  background: transparent;
  border: none;
  box-shadow: none;
}

/* Handle è¿æ¥æ—¶çš„æ ·å¼ - å¢å¼ºå‘å…‰æ•ˆæœ */
.workflow-root .react-flow__handle.connecting,
.workflow-root .react-flow__handle.connectingfrom,
.workflow-root .react-flow__handle.connectingto {
  transform: rotate(45deg) scale(1.3);
  box-shadow: 0 0 12px var(--handle-color, rgba(24, 144, 255, 0.6));
}

/* Handle å¯è¿æ¥çŠ¶æ€ */
.workflow-root .react-flow__handle.connectable {
  cursor: crosshair;
}

/* Handle ä¸å¯è¿æ¥çŠ¶æ€ */
.workflow-root .react-flow__handle.not-connectable {
  cursor: not-allowed;
  opacity: 0.3;
  filter: grayscale(100%);
}

/* ========== å®æ—¶è¿çº¿é¢„è§ˆæ ·å¼ v4.0 ========== */
/* é™å®šåœ¨ .workflow-root ä½œç”¨åŸŸå†… */
/* å…¼å®¹çš„ Handle - ç»¿è‰²å‘å…‰æ•ˆæœï¼ˆé€‚é…è±å½¢è®¾è®¡ï¼‰ */
.workflow-root .react-flow__handle.handle-compatible {
  border-color: #4ade80;
  background: #4ade80;
  box-shadow:
    0 0 12px rgba(74, 222, 128, 0.8),
    0 0 24px rgba(74, 222, 128, 0.4);
  transform: rotate(45deg) scale(1.4);
  animation: pulse-compatible-diamond 1.2s ease-in-out infinite;
  z-index: 100;
}

/* ä¸å…¼å®¹çš„ Handle - ç°è‰²æ·¡å‡º */
.workflow-root .react-flow__handle.handle-incompatible {
  opacity: 0.2;
  cursor: not-allowed;
  filter: grayscale(100%);
  transform: rotate(45deg) scale(0.8);
}

/* å…¼å®¹ Handle è„‰å†²åŠ¨ç”» - è±å½¢ç‰ˆæœ¬ */
@keyframes pulse-compatible-diamond {
  0%,
  100% {
    box-shadow:
      0 0 12px rgba(74, 222, 128, 0.8),
      0 0 24px rgba(74, 222, 128, 0.4);
    transform: rotate(45deg) scale(1.4);
  }
  50% {
    box-shadow:
      0 0 16px rgba(74, 222, 128, 1),
      0 0 32px rgba(74, 222, 128, 0.6);
    transform: rotate(45deg) scale(1.5);
  }
}

/* ========== ğŸ’ Cherry Studio Edge ç®€çº¦æ ·å¼ ========== */
/* é™å®šåœ¨ .workflow-root ä½œç”¨åŸŸå†…ï¼Œä½¿ç”¨å·¥ä½œæµä¸»é¢˜å˜é‡ */

/* é»˜è®¤è¾¹ - ä½¿ç”¨å·¥ä½œæµä¸»é¢˜è‰²ï¼Œå¢åŠ å¯è§æ€§ */
.workflow-root .react-flow__edge-path {
  stroke: var(--workflow-theme-primary, var(--color-primary, #1890ff));
  stroke-width: 3px;
  transition: all 0.2s ease;
  filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.2));
}

/* Edge hover æ•ˆæœ - æ›´æ˜æ˜¾ */
.workflow-root .react-flow__edge.selectable:hover .react-flow__edge-path {
  stroke: var(--workflow-theme-primary, var(--color-primary, #1890ff));
  stroke-width: 4px;
  opacity: 1;
  filter: drop-shadow(0 0 6px var(--workflow-theme-primary, #1890ff));
}

/* Edge é€‰ä¸­çŠ¶æ€ - é«˜äº® */
.workflow-root .react-flow__edge.selected .react-flow__edge-path {
  stroke: var(--workflow-theme-success, #52c41a);
  stroke-width: 4px;
  opacity: 1;
  filter: drop-shadow(0 0 8px var(--workflow-theme-success, #52c41a));
}

/* Edge åŠ¨ç”»æ•ˆæœ - æ•°æ®æµåŠ¨ */
.workflow-root .react-flow__edge.animated path {
  stroke-dasharray: 6 4;
  animation: edge-flow 0.6s linear infinite;
}

@keyframes edge-flow {
  from {
    stroke-dashoffset: 10;
  }
  to {
    stroke-dashoffset: 0;
  }
}

/* Edge æ ‡ç­¾æ ·å¼ - Cherry é£æ ¼ */
.workflow-root .react-flow__edge-text {
  fill: var(--color-text);
  font-size: 11px;
  font-weight: 500;
}

.workflow-root .react-flow__edge-textbg {
  fill: var(--color-background);
  rx: 6px;
  ry: 6px;
  stroke: var(--color-border);
  stroke-width: 1px;
}

/* ç®­å¤´æ ‡è®° - ä½¿ç”¨å·¥ä½œæµä¸»é¢˜è‰² */
.workflow-root .react-flow__edge .react-flow__arrowhead {
  fill: var(--workflow-theme-primary, var(--color-primary, #1890ff));
}

.workflow-root .react-flow__edge.selectable:hover .react-flow__arrowhead {
  fill: var(--workflow-theme-primary, var(--color-primary, #1890ff));
}

.workflow-root .react-flow__edge.selected .react-flow__arrowhead {
  fill: var(--workflow-theme-primary, var(--color-primary, #1890ff));
}

/* ========== è¿æ¥çº¿æ ·å¼ (æ­£åœ¨æ‹–åŠ¨æ—¶) ========== */
.workflow-root .react-flow__connection-path {
  stroke: #faad14 !important; /* æ©™è‰²ï¼Œæ‹–åŠ¨æ—¶éå¸¸é†’ç›® */
  stroke-width: 4px !important;
  stroke-dasharray: 8 4 !important;
  animation: connection-flow 0.4s linear infinite !important;
  filter: drop-shadow(0 0 8px rgba(250, 173, 20, 0.8)) !important;
}

/* è¿æ¥çº¿å®¹å™¨ - ç¡®ä¿å¯è§ */
.workflow-root .react-flow__connection {
  z-index: 1000;
}

@keyframes connection-flow {
  to {
    stroke-dashoffset: -12;
  }
}

/* ========== è¾¹é‡è¿æ ·å¼ (æ‹–åŠ¨å·²æœ‰è¿çº¿æ—¶) ========== */
/* æ­£åœ¨è¢«é‡è¿çš„è¾¹ - é«˜äº®æ˜¾ç¤º */
.workflow-root .react-flow__edge.updating .react-flow__edge-path {
  stroke: var(--workflow-theme-warning, #faad14) !important;
  stroke-width: 4px;
  stroke-dasharray: 8 4;
  animation: connection-flow 0.5s linear infinite;
  filter: drop-shadow(0 2px 8px rgba(250, 173, 20, 0.8));
}

/* è¾¹ç«¯ç‚¹æ‚¬åœæç¤º - å½“é¼ æ ‡é è¿‘è¾¹çš„ç«¯ç‚¹æ—¶æ˜¾ç¤ºå¯æ‹–åŠ¨æç¤º */
/* React Flow v12 ä½¿ç”¨ reconnectRadius æ¥æ£€æµ‹æ‚¬åœ */
.workflow-root .react-flow__edge:hover {
  cursor: pointer;
}

/* è¾¹å¯é€‰ä¸­æ—¶çš„æ‚¬åœæ•ˆæœ - æ›´æ˜æ˜¾ */
.workflow-root .react-flow__edge.selectable {
  cursor: pointer;
}

.workflow-root .react-flow__edge.selectable:hover .react-flow__edge-path {
  stroke-width: 4px !important;
  filter: drop-shadow(0 0 6px currentColor);
}

/* è¾¹é€‰ä¸­çŠ¶æ€ - æ›´æ˜æ˜¾çš„é«˜äº® */
.workflow-root .react-flow__edge.selected .react-flow__edge-path {
  stroke-width: 4px !important;
  filter: drop-shadow(0 0 8px var(--workflow-theme-primary, #1890ff));
}

/* ========== èŠ‚ç‚¹æ ·å¼ä¼˜åŒ– ========== */
/* é™å®šåœ¨ .workflow-root ä½œç”¨åŸŸå†… */
.workflow-root .react-flow__node {
  cursor: grab;
  transition: box-shadow 0.3s;
  /* ç¡®ä¿èŠ‚ç‚¹å®¹å™¨æ­£ç¡®ä¼ é€’å°ºå¯¸ç»™å­å…ƒç´  */
  padding: 0;
  border: none;
  background: transparent;
  border-radius: 0;
}

.workflow-root .react-flow__node:active {
  cursor: grabbing;
}

/* èŠ‚ç‚¹é€‰ä¸­çŠ¶æ€ - ç”±è‡ªå®šä¹‰ç»„ä»¶å¤„ç†ï¼Œè¿™é‡Œä¸æ·»åŠ é¢å¤–æ ·å¼ */
.workflow-root .react-flow__node.selected {
  /* é€‰ä¸­æ¡†ç”±è‡ªå®šä¹‰èŠ‚ç‚¹ç»„ä»¶å†…éƒ¨å¤„ç† */
  box-shadow: none;
}

/* èŠ‚ç‚¹æ‹–åŠ¨çŠ¶æ€ */
.workflow-root .react-flow__node.dragging {
  opacity: 0.8;
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
}

/* ========== èƒŒæ™¯æ ·å¼ ========== */
/* é™å®šåœ¨ .workflow-root ä½œç”¨åŸŸå†… */
.workflow-root .react-flow__background {
  background-color: transparent;
}

/* èƒŒæ™¯ç‚¹æ ·å¼ */
.workflow-root .react-flow__background-pattern.dots {
  fill: var(--ant-color-border);
  opacity: 0.4;
}

/* åŒå±‚èƒŒæ™¯æ•ˆæœ - å¤§ç½‘æ ¼ */
.workflow-root .react-flow__background-pattern.lines {
  stroke: var(--ant-color-border);
  stroke-opacity: 0.15;
}

/* ========== æ§åˆ¶æŒ‰é’®æ ·å¼ ========== */
.workflow-root .react-flow__controls {
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  border-radius: 8px;
  overflow: hidden;
  background: var(--ant-color-bg-container);
}

.workflow-root .react-flow__controls-button {
  background: var(--ant-color-bg-container);
  border-bottom: 1px solid var(--ant-color-border);
  color: var(--ant-color-text);
  transition: background 0.2s;
}

.workflow-root .react-flow__controls-button:hover {
  background: var(--ant-color-bg-elevated);
}

.workflow-root .react-flow__controls-button:last-child {
  border-bottom: none;
}

/* ========== MiniMap æ ·å¼ ========== */
.workflow-root .react-flow__minimap {
  background: var(--ant-color-bg-container);
  border: 1px solid var(--ant-color-border);
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

.workflow-root .react-flow__minimap-mask {
  fill: rgba(0, 0, 0, 0.1);
}

.workflow-root .react-flow__minimap-node {
  fill: var(--ant-color-border);
  stroke: none;
}

/* ========== é€‰æ‹©æ¡†æ ·å¼ ========== */
.workflow-root .react-flow__selection {
  background: rgba(24, 144, 255, 0.1);
  border: 1px dashed var(--workflow-theme-primary, #1890ff);
}

/* ========== æ·±è‰²ä¸»é¢˜é€‚é… ========== */
/* é™å®šåœ¨ .workflow-root ä½œç”¨åŸŸå†… */
/* ä½¿ç”¨ Ant Design æš—è‰² tokenï¼Œä¸ä½¿ç”¨å›ºå®šå€¼ */
[data-theme='dark'] .workflow-root .react-flow {
  --xy-edge-stroke-default: var(--ant-color-text-quaternary); /* ä½¿ç”¨ Ant æ–‡æœ¬å››çº§è‰² */
  --xy-node-border-default: 2px solid var(--ant-color-border);
}

[data-theme='dark'] .workflow-root .react-flow__edge-path {
  stroke: var(--ant-color-text-quaternary); /* ä½¿ç”¨ Ant æ–‡æœ¬å››çº§è‰² */
  filter: drop-shadow(0 1px 3px rgba(255, 255, 255, 0.1)); /* æ·±è‰²ä¸»é¢˜ç™½è‰²é˜´å½± */
}

[data-theme='dark'] .workflow-root .react-flow__background-pattern.dots {
  fill: var(--ant-color-border);
}

[data-theme='dark'] .workflow-root .react-flow__controls {
  background: var(--ant-color-bg-container);
  border: 1px solid var(--ant-color-border);
}

[data-theme='dark'] .workflow-root .react-flow__controls-button {
  background: var(--ant-color-bg-container);
  border-bottom: 1px solid var(--ant-color-border);
  color: var(--ant-color-text);
}

[data-theme='dark'] .workflow-root .react-flow__controls-button:hover {
  background: var(--ant-color-bg-elevated);
}

[data-theme='dark'] .workflow-root .react-flow__minimap {
  background: var(--ant-color-bg-container);
  border-color: var(--ant-color-border);
}

/* ========== è¿æ¥æŒ‡ç¤ºå™¨ ========== */
/* é™å®šåœ¨ .workflow-root ä½œç”¨åŸŸå†… */
.workflow-root .react-flow__handle.connectionindicator {
  pointer-events: all;
}

.workflow-root .react-flow__handle.connectionindicator:hover {
  border-color: var(--xy-theme-edge-hover);
  background-color: var(--ant-color-bg-container);
  transform: scale(1.3);
}

/* ========== è‡ªå®šä¹‰è¿æ¥çº¿ç±»å‹ ========== */
.workflow-root .react-flow__edge.updating .react-flow__edge-path {
  stroke: var(--ant-color-text-tertiary);
  stroke-dasharray: 5;
  animation: dash 0.5s linear infinite;
}

@keyframes dash {
  to {
    stroke-dashoffset: -10;
  }
}

/* ========== æ€§èƒ½ä¼˜åŒ– ========== */
.workflow-root .react-flow__renderer {
  /* ä½¿ç”¨ GPU åŠ é€Ÿ */
  transform: translateZ(0);
  will-change: transform;
}

/* ========== é˜»æ­¢æ‹–æ‹½å†²çª ========== */
.workflow-root .nodrag {
  -webkit-user-drag: none;
  user-select: none;
}

/* ========== ç”»å¸ƒäº¤äº’æç¤º ========== */
.workflow-root .react-flow__pane {
  cursor: grab;
}

.workflow-root .react-flow__pane:active {
  cursor: grabbing;
}
